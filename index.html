<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sƒ±nav Sistemi (Final Tam S√ºr√ºm)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;}
        .app-card { background-color:white;padding:2.5rem;border-radius:1.5rem;box-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);max-width:450px;width:90%;transition:all .3s;position:relative;}
        .header-bg { background: linear-gradient(135deg,#4f46e5 0%,#818cf8 100%); color:white;padding:1rem 0;border-radius:1rem 1rem 0 0;margin:-2.5rem -2.5rem 1.5rem -2.5rem;text-align:center;}
        .button{transition:all .2s;box-shadow:0 4px 6px rgba(0,0,0,0.1)}
        .button:hover{transform:translateY(-1px);box-shadow:0 6px 10px rgba(0,0,0,0.15)}
        .teacher-mode { max-width: 1400px !important; width: 98% !important; } 
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .paste-area { border: 2px dashed #cbd5e0; border-radius: 0.5rem; padding: 1rem; background-color: #f9fafb; cursor: text; min-height: 120px; }
        .paste-area:focus { outline: none; border-color: #4f46e5; }
    </style>
</head>
<body>

    <div id="app" class="app-card">
        <div id="loginHeader" class="header-bg">
            <h1 class="text-2xl font-extrabold">√ñƒürenci Giri≈üi</h1>
        </div>
        
        <div id="connectionStatus" class="hidden mb-4 text-xs font-bold text-center p-2 rounded border"></div>
        
        <div id="mainContentArea">
            <div id="loadingIndicator" class="text-center py-10">
                <div class="loader"></div>
                <p id="loadingText" class="text-sm text-gray-500 mt-4 font-bold">Sistem Ba≈ülatƒ±lƒ±yor...</p>
            </div>
        </div>
    </div>

    <div id="customModal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-50">
        <div id="modalContent" class="bg-white rounded-xl p-6 max-w-3xl w-full shadow-2xl overflow-y-auto max-h-[90vh]"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, collection, onSnapshot, serverTimestamp, query, where, getDocs, deleteDoc, getDoc, addDoc, updateDoc, setDoc, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- FIREBASE AYARLARI ---
        const firebaseConfig = {
            apiKey: "AIzaSyCHhFAHbWnclad6yFuI-Pw9gX6F_Dx1B2c",
            authDomain: "online-sinav-b3644.firebaseapp.com",
            projectId: "online-sinav-b3644",
            storageBucket: "online-sinav-b3644.firebasestorage.app",
            messagingSenderId: "965507531268",
            appId: "1:965507531268:web:94cfd13774a40b6cf16b51"
        };

        // --- GLOBAL DEƒûƒ∞≈ûKENLER ---
        let db, auth;
        let isAuthReady = false, isDbConnected = false;
        let adminMasterCode = null;
        
        // √áoklu Kullanƒ±cƒ± Deƒüi≈ükenleri
        let isTeacherMode = false;
        let currentUser = { username: "", role: "", name: "" };
        let isSuperAdmin = false;
        let systemPreparerName = "Sistem Y√∂neticisi";

        // Sƒ±nav Deƒüi≈ükenleri
        let currentExamConfig = { exam_code: "DEFAULT", teacher_name: "Y√ºkleniyor...", time_limit: 600, exam_description: "..." };
        let quizQuestions = [];
        let studentList = [];
        let studentData = {};
        let selectedAnswers = [];
        let questionOrder = [];
        let currentQuestionIndex = 0;
        let focusLossCount = 0;
        let currentSessionDocId = null;
        let timerInterval = null;
        let examendTimeStamp = null;
        let autoSaveInterval = null;
        let allSubmissions = [];

        // --- YARDIMCI FONKSƒ∞YONLAR ---
        function sanitizeInput(input) { if (typeof input !== 'string') return ''; return input.replace(/</g, '&lt;').replace(/>/g, '&gt;').substring(0, 500); }
        function sanitizeExamCode(code) { if (typeof code !== 'string') return ''; return code.replace(/[^a-zA-Z0-9_]/g, '').toUpperCase().substring(0, 20); }
        const getConfigRef = (code) => doc(db, "exam_settings", sanitizeExamCode(code));
        const getQuestionsRef = (code) => doc(db, "questions_pool", sanitizeExamCode(code));

        // --- BA≈ûLATMA ---
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                await signInAnonymously(auth);
                onAuthStateChanged(auth, async (user) => { if (user) { isAuthReady = true; await checkConnectivity(); } });
            } catch (error) { showCustomAlert("Kritik Hata", "Firebase ba≈ülatƒ±lamadƒ±: " + error.message); }
        }

        async function checkConnectivity() {
            const statusDiv = document.getElementById('connectionStatus');
            try {
                const adminSnap = await getDoc(doc(db, "exam_settings", "admin_config"));
                if (adminSnap.exists()) {
                    const data = adminSnap.data();
                    adminMasterCode = data.master_code;
                    isDbConnected = true;
                    statusDiv.innerHTML = "üü¢ Sistem √áevrimi√ßi";
                    statusDiv.className = "mb-4 text-xs font-bold text-center p-2 rounded border bg-green-100 text-green-800 border-green-300";
                } else { throw new Error("Admin konfig√ºrasyonu eksik."); }
            } catch(e) {
                isDbConnected = false;
                adminMasterCode = null;
                statusDiv.innerHTML = `üî¥ BAƒûLANTI HATASI: ${e.message}`;
                statusDiv.className = "mb-4 text-xs font-bold text-center p-2 rounded border bg-red-100 text-red-800 border-red-300";
            }
            statusDiv.classList.remove('hidden');
            document.getElementById('loadingIndicator').classList.add('hidden');
            showLoginForm();
        }

        function resetApp() {
            if (timerInterval) clearInterval(timerInterval);
            if (autoSaveInterval) clearInterval(autoSaveInterval);
            window.onblur = null; document.oncontextmenu = null;
            
            currentUser = { username: "", role: "", name: "" };
            isSuperAdmin = false;
            isTeacherMode = false;
            studentData = {};
            
            document.getElementById('app').className = 'app-card max-w-md';
            document.getElementById('connectionStatus').classList.remove('hidden');
            showLoginForm();
        }

        // --- √ñƒûRENCƒ∞ Gƒ∞Rƒ∞≈ûƒ∞ ---
        function showLoginForm() {
            document.getElementById('loginHeader').innerHTML = '<h1 class="text-2xl font-extrabold">√ñƒürenci Giri≈üi</h1>';
            document.getElementById('mainContentArea').innerHTML = `
                <div class="space-y-4">
                    <div id="examInfoArea" class="hidden bg-yellow-50 border border-yellow-200 p-3 rounded-lg text-sm text-yellow-800"></div>
                    <input id="examCodeInput" type="text" placeholder="SINAV KODU (√ñrn: 9A_MAT)" class="w-full p-3 border rounded-lg uppercase font-bold text-center tracking-widest">
                    <div id="studentLoginFields" class="space-y-4"><p class="text-sm text-center text-gray-400 italic mt-2">Sƒ±nav kodunu girince liste a√ßƒ±lacaktƒ±r.</p></div>
                    <button id="startQuizButton" class="button w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-lg opacity-50 cursor-not-allowed" disabled>Sƒ±nava Ba≈üla</button>
                    <div class="border-t pt-4 mt-4"><button id="teacherLoginButton" class="text-gray-400 hover:text-gray-600 text-xs w-full text-center">Y√∂netici / √ñƒüretmen Giri≈üi</button></div>
                </div>`;

            document.getElementById('teacherLoginButton').onclick = showTeacherLogin;
            document.getElementById('examCodeInput').oninput = handleCodeEntry;
            document.getElementById('startQuizButton').onclick = handleStudentLogin;
        }

        let typingTimer;
        async function handleCodeEntry() {
            clearTimeout(typingTimer);
            const code = sanitizeExamCode(document.getElementById('examCodeInput').value.trim());
            const infoArea = document.getElementById('examInfoArea');
            const loginFields = document.getElementById('studentLoginFields');
            const btn = document.getElementById('startQuizButton');

            if (code.length < 3) { infoArea.classList.add('hidden'); return; }

            typingTimer = setTimeout(async () => {
                await fetchExamData(code);
                const mins = Math.floor(currentExamConfig.time_limit / 60);
                infoArea.innerHTML = `<p class="font-bold">Sƒ±nav: ${code}</p><p>${sanitizeInput(currentExamConfig.exam_description)}</p><p class="text-xs mt-1">‚è±Ô∏è ${mins} Dk | üìù ${quizQuestions.length} Soru</p>`;
                infoArea.classList.remove('hidden');

                if (studentList.length === 0) {
                    loginFields.innerHTML = `<div class="bg-red-50 p-2 rounded text-xs text-red-700 mb-2">‚ö†Ô∏è Liste yok. Manuel giri≈ü yapƒ±nƒ±z.</div>
                        <input id="nameInput" type="text" placeholder="Ad Soyad" class="w-full p-3 border rounded-lg">
                        <input id="numberInput" type="number" placeholder="Okul No" class="w-full p-3 border rounded-lg">
                        <input id="classInput" type="text" placeholder="Sƒ±nƒ±f" class="w-full p-3 border rounded-lg">`;
                    const check = () => { btn.disabled = !(document.getElementById('nameInput').value && document.getElementById('numberInput').value && document.getElementById('classInput').value); btn.classList.toggle('opacity-50', btn.disabled); };
                    loginFields.oninput = check;
                } else {
                    const students = studentList.sort((a, b) => a.name.localeCompare(b.name, 'tr'));
                    const classes = [...new Set(students.map(s => s.className))].sort();
                    loginFields.innerHTML = `
                        <select id="classSelector" class="w-full p-3 border rounded-lg font-bold text-indigo-700 bg-white"><option value="">-- Sƒ±nƒ±f --</option>${classes.map(c => `<option value="${sanitizeInput(c)}">${sanitizeInput(c)}</option>`).join('')}</select>
                        <select id="studentSelector" class="w-full p-3 border rounded-lg bg-gray-100" disabled><option value="">-- √ñnce Sƒ±nƒ±f --</option></select>
                        <div id="verificationArea" class="hidden mt-2"><input id="numberVerify" type="number" placeholder="Okul Numaranƒ±zƒ± Girin" class="w-full p-3 border-2 border-indigo-300 rounded-lg"></div>`;
                    
                    document.getElementById('classSelector').onchange = (e) => {
                        const cls = e.target.value;
                        const sel = document.getElementById('studentSelector');
                        sel.innerHTML = '<option value="">-- ƒ∞sim --</option>'; sel.disabled = !cls;
                        if(cls) sel.innerHTML += students.filter(s => s.className === cls).map(s => `<option value="${s.number}_${s.name}">${sanitizeInput(s.name)}</option>`).join('');
                    };
                    document.getElementById('studentSelector').onchange = (e) => { document.getElementById('verificationArea').classList.toggle('hidden', !e.target.value); };
                    document.getElementById('numberVerify').oninput = (e) => { btn.disabled = !e.target.value; btn.classList.toggle('opacity-50', btn.disabled); };
                }
            }, 500);
        }

        async function fetchExamData(code) {
            if (!isDbConnected) return;
            try {
                const configSnap = await getDoc(getConfigRef(code));
                currentExamConfig = configSnap.exists() ? { exam_code: code, ...configSnap.data() } : { exam_code: code, time_limit: 600, exam_description: "Sƒ±nav ayarƒ± yok." };
                const questionsSnap = await getDoc(getQuestionsRef(code));
                quizQuestions = questionsSnap.exists() ? (questionsSnap.data().questions_list || []) : [];
                const listSnap = await getDoc(doc(db, "student_lists", code));
                studentList = listSnap.exists() ? (listSnap.data().students || []) : [];
            } catch(e) { console.error(e); }
        }

        async function handleStudentLogin() {
            const code = document.getElementById('examCodeInput').value;
            let name, number, className;
            
            if (document.getElementById('studentSelector')) {
                const val = document.getElementById('studentSelector').value;
                const inputNum = document.getElementById('numberVerify').value;
                if(!val || val.split('_')[0] !== inputNum) return alert("Numara e≈üle≈ümiyor!");
                [number, name] = val.split('_');
                className = document.getElementById('classSelector').value;
            } else {
                name = document.getElementById('nameInput').value;
                number = document.getElementById('numberInput').value;
                className = document.getElementById('classInput').value;
            }

            if (quizQuestions.length === 0) return alert("Soru yok!");
            
            studentData = { name, number, className, examCode: code };
            const studentKey = `${code}_${number}`;
            
            // Sƒ±nav bitmi≈ü mi kontrol√º
            const subSnap = await getDocs(query(collection(db, "quiz_submissions"), where("studentKey", "==", studentKey)));
            if (!subSnap.empty) return alert("Bu sƒ±navƒ± zaten tamamladƒ±nƒ±z.");

            startQuiz();
        }

        // --- SINAV EKRANI ---
        function startQuiz() {
            document.getElementById('app').className = 'app-card max-w-3xl w-full';
            document.getElementById('loginHeader').innerHTML = `<div class="flex justify-between px-4"><span>${studentData.name}</span><span>${studentData.examCode}</span></div>`;
            document.getElementById('mainContentArea').innerHTML = `
                <div class="flex justify-between items-center mb-4 border-b pb-2"><span class="font-bold text-indigo-600">Soru: <span id="qCount">1</span> / ${quizQuestions.length}</span><div id="timerDisplay" class="text-xl font-mono font-bold text-white bg-indigo-600 p-1 px-3 rounded">--:--</div></div>
                <div id="questionArea" class="min-h-[250px]"></div>
                <div class="mt-6 flex justify-between"><button id="prevBtn" class="button bg-gray-500 text-white py-2 px-4 rounded opacity-50" disabled>√ñnceki</button><button id="nextBtn" class="button bg-indigo-600 text-white py-2 px-6 rounded font-bold">Sonraki</button></div>`;
            
            // Basit sƒ±ralama
            questionOrder = Array.from({length: quizQuestions.length}, (_, i) => i);
            selectedAnswers = Array(quizQuestions.length).fill(null);
            examendTimeStamp = Date.now() + (currentExamConfig.time_limit * 1000);
            
            renderQuestion(0);
            timerInterval = setInterval(updateTimer, 1000);
            
            document.getElementById('prevBtn').onclick = () => { if(currentQuestionIndex > 0) renderQuestion(--currentQuestionIndex); };
            document.getElementById('nextBtn').onclick = () => { 
                if(currentQuestionIndex < quizQuestions.length - 1) renderQuestion(++currentQuestionIndex);
                else finishQuiz();
            };
            
            window.onblur = () => { focusLossCount++; }; // Odak kaybƒ± takibi
        }

        function renderQuestion(idx) {
            const q = quizQuestions[idx];
            document.getElementById('qCount').innerText = idx + 1;
            const labels = ['A','B','C','D','E'];
            
            document.getElementById('questionArea').innerHTML = `
                <div class="font-semibold text-lg text-gray-800 mb-4">Soru ${idx + 1}: ${sanitizeInput(q.question)}</div>
                ${q.image ? `<div class="mb-4 text-center"><img src="${q.image}" class="max-h-60 inline-block rounded border"></div>` : ''}
                <div class="space-y-3">
                    ${q.options.map((opt, i) => `
                        <label class="flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all ${selectedAnswers[idx] === opt ? 'bg-indigo-50 border-indigo-500' : 'hover:bg-gray-50'}">
                            <input type="radio" name="opt" value="${sanitizeInput(opt)}" class="hidden" ${selectedAnswers[idx] === opt ? 'checked' : ''}>
                            <div class="w-6 h-6 flex items-center justify-center border-2 rounded-full mr-3 ${selectedAnswers[idx] === opt ? 'border-indigo-600 bg-indigo-600 text-white' : 'border-gray-400'}">${labels[i]}</div>
                            <span class="text-gray-700">${sanitizeInput(opt)}</span>
                        </label>`).join('')}
                </div>`;

            document.querySelectorAll('input[name="opt"]').forEach(el => el.onchange = (e) => {
                selectedAnswers[idx] = e.target.value;
                renderQuestion(idx);
            });
            
            document.getElementById('prevBtn').disabled = (idx === 0);
            document.getElementById('prevBtn').classList.toggle('opacity-50', idx===0);
            document.getElementById('nextBtn').innerText = (idx === quizQuestions.length - 1) ? "SINAVI Bƒ∞Tƒ∞R" : "Sonraki";
        }

        function updateTimer() {
            const diff = Math.ceil((examendTimeStamp - Date.now()) / 1000);
            if (diff <= 0) return finishQuiz();
            const m = Math.floor(diff / 60);
            const s = diff % 60;
            document.getElementById('timerDisplay').innerText = `${m}:${s < 10 ? '0'+s : s}`;
        }

        async function finishQuiz() {
            if(timerInterval) clearInterval(timerInterval);
            window.onblur = null;

            let c=0, i=0, e=0;
            quizQuestions.forEach((q, idx) => {
                const ans = selectedAnswers[idx];
                if(!ans) e++; else if(ans === q.answer) c++; else i++;
            });
            const score = (quizQuestions.length > 0) ? (c * 100 / quizQuestions.length).toFixed(2) : 0;
            
            await addDoc(collection(db, "quiz_submissions"), {
                ...studentData, studentKey: `${studentData.examCode}_${studentData.number}`,
                score, correct: c, incorrect: i, empty: e, focusLossCount, timestamp: serverTimestamp()
            });
            
            document.getElementById('mainContentArea').innerHTML = `
                <div class="text-center py-10">
                    <div class="text-5xl font-bold text-indigo-700 mb-2">${score}</div>
                    <p class="text-gray-500">Puanƒ±nƒ±z</p>
                    <div class="grid grid-cols-3 gap-2 mt-6 max-w-xs mx-auto">
                        <div class="bg-green-100 p-2 rounded text-green-800 font-bold">${c} D</div>
                        <div class="bg-red-100 p-2 rounded text-red-800 font-bold">${i} Y</div>
                        <div class="bg-gray-100 p-2 rounded text-gray-800 font-bold">${e} B</div>
                    </div>
                    <button onclick="location.reload()" class="mt-8 bg-gray-800 text-white px-6 py-3 rounded font-bold">√áƒ±kƒ±≈ü</button>
                </div>`;
        }

        // --- Y√ñNETƒ∞Cƒ∞ / √ñƒûRETMEN Gƒ∞Rƒ∞≈ûƒ∞ ---
        function showTeacherLogin() {
            document.getElementById('mainContentArea').innerHTML = `
                <div class="space-y-4">
                    <h3 class="text-center font-bold text-gray-800 text-lg">√ñƒüretmen / Y√∂netici Giri≈üi</h3>
                    <div class="bg-yellow-50 p-3 rounded text-xs text-yellow-800 border border-yellow-200"><strong>Not:</strong> Y√∂netici iseniz kullanƒ±cƒ± adƒ±na "admin" yazƒ±n.</div>
                    <input id="loginUser" type="text" placeholder="Kullanƒ±cƒ± Adƒ±" class="w-full p-3 border rounded-lg">
                    <input id="loginPass" type="password" placeholder="≈ûifre" class="w-full p-3 border rounded-lg">
                    <button id="loginBtn" class="button bg-indigo-600 text-white w-full py-3 rounded-lg font-bold hover:bg-indigo-700">Giri≈ü Yap</button>
                    <button id="backBtn" class="button bg-gray-200 text-gray-700 w-full py-3 rounded-lg font-semibold">Geri D√∂n</button>
                </div>`;

            document.getElementById('backBtn').onclick = showLoginForm;
            
            document.getElementById('loginBtn').onclick = async () => {
                const u = document.getElementById('loginUser').value.trim();
                const p = document.getElementById('loginPass').value.trim();
                if(!u || !p) return alert("Bilgileri doldurun.");
                
                // 1. ADMIN KONTROL√ú
                if (u === "admin" && p === adminMasterCode) {
                    currentUser = { username: "admin", role: "admin", name: systemPreparerName };
                    isSuperAdmin = true; isTeacherMode = true;
                    showDashboard();
                    return;
                }
                // 2. √ñƒûRETMEN KONTROL√ú
                try {
                    const snap = await getDocs(query(collection(db, "teachers"), where("username", "==", u), where("password", "==", p)));
                    if (!snap.empty) {
                        const tData = snap.docs[0].data();
                        currentUser = { username: tData.username, role: "teacher", name: tData.full_name };
                        isSuperAdmin = false; isTeacherMode = true;
                        showDashboard();
                    } else { alert("Hatalƒ± giri≈ü!"); }
                } catch (e) { alert("Hata: " + e.message); }
            };
        }

        // --- DASHBOARD (Y√ñNETƒ∞M PANELƒ∞) ---
        function showDashboard() {
            document.getElementById('connectionStatus').classList.add('hidden');
            document.getElementById('app').className = 'app-card teacher-mode';
            document.getElementById('loginHeader').innerHTML = `
                <div class="flex justify-between items-center px-4">
                    <div class="text-left"><h1 class="text-xl font-bold">Y√∂netim Paneli</h1><p class="text-xs opacity-80">${currentUser.name} (${isSuperAdmin?'Y√∂netici':'√ñƒüretmen'})</p></div>
                    <button id="logoutBtn" class="text-sm bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">√áƒ±kƒ±≈ü</button>
                </div>`;
            document.getElementById('logoutBtn').onclick = resetApp;

            document.getElementById('mainContentArea').innerHTML = `
                <div class="flex flex-wrap gap-2 mb-6 border-b pb-4">
                    <button onclick="window.changeTab('results')" class="flex-1 px-3 py-2 bg-indigo-600 text-white rounded text-xs font-bold hover:bg-indigo-700">üìä Sonu√ßlar</button>
                    <button onclick="window.changeTab('myexams')" class="flex-1 px-3 py-2 bg-purple-600 text-white rounded text-xs font-bold hover:bg-purple-700">üìÇ Sƒ±navlarƒ±m</button>
                    <button onclick="window.changeTab('questions')" class="flex-1 px-3 py-2 bg-orange-600 text-white rounded text-xs font-bold hover:bg-orange-700">üìù Soru Y√ºkle</button>
                    <button onclick="window.changeTab('lists')" class="flex-1 px-3 py-2 bg-teal-600 text-white rounded text-xs font-bold hover:bg-teal-700">üë• √ñƒürenci Y√ºkle</button>
                    <button onclick="window.changeTab('settings')" class="flex-1 px-3 py-2 bg-gray-600 text-white rounded text-xs font-bold hover:bg-gray-700">‚öôÔ∏è Ayarlar</button>
                    ${isSuperAdmin ? `<button onclick="window.changeTab('teachers')" class="flex-1 px-3 py-2 bg-pink-600 text-white rounded text-xs font-bold hover:bg-pink-700">üë®‚Äçüè´ √ñƒüretmenler</button>` : ''}
                </div>
                
                <div id="tab-results" class="tab-content">
                    <div class="flex gap-2 mb-2"><input id="fCode" placeholder="Kod" class="border p-1"><button onclick="window.exportExcel()" class="bg-green-600 text-white px-2 rounded">Excel</button></div>
                    <div class="overflow-auto max-h-[500px] border rounded-lg"><table class="min-w-full divide-y divide-gray-200 text-sm"><thead class="bg-gray-100 sticky top-0"><tr><th class="p-3">√ñƒürenci</th><th class="p-3">Kod</th><th class="p-3">Puan</th><th class="p-3">ƒ∞≈ülem</th></tr></thead><tbody id="resultsTableBody" class="bg-white divide-y"></tbody></table></div>
                </div>
                
                <div id="tab-myexams" class="tab-content hidden"><div id="myExamsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div></div>
                
                <div id="tab-questions" class="tab-content hidden"><div class="max-w-2xl mx-auto"><input id="uploadQCode" class="w-full p-2 border rounded mb-2 uppercase" placeholder="Sƒ±nav Kodu"><textarea id="jsonInput" rows="10" class="w-full p-3 text-xs border rounded" placeholder='[{"question":"Soru?","options":["A","B"],"answer":"A"}]'></textarea><button id="btnUploadQ" class="bg-orange-600 text-white px-6 py-2 rounded font-bold w-full mt-2">Y√úKLE</button></div></div>
                
                <div id="tab-lists" class="tab-content hidden"><div class="max-w-2xl mx-auto"><input id="uploadListCode" class="w-full p-2 border rounded mb-2 uppercase" placeholder="Sƒ±nav Kodu"><div class="paste-area" id="listInput" contenteditable="true"></div><button id="btnUploadList" class="w-full mt-2 bg-teal-600 text-white py-2 rounded font-bold">KAYDET</button></div></div>
                
                <div id="tab-settings" class="tab-content hidden">
                    <div class="max-w-lg mx-auto space-y-4 bg-white p-6 rounded shadow">
                        <h3 class="font-bold">Yeni Sƒ±nav Olu≈ütur</h3>
                        <input id="setExamCode" class="w-full p-2 border rounded uppercase" placeholder="Sƒ±nav Kodu">
                        <input id="setTime" type="number" class="w-full p-2 border rounded" value="40" placeholder="S√ºre (Dk)">
                        <input id="setDesc" class="w-full p-2 border rounded" placeholder="A√ßƒ±klama">
                        <button id="btnSaveSettings" class="w-full bg-gray-800 text-white py-2 rounded font-bold">Olu≈ütur</button>
                    </div>
                </div>

                <div id="tab-teachers" class="tab-content hidden">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-pink-50 p-4 rounded h-fit"><h3 class="font-bold mb-2">√ñƒüretmen Ekle</h3><input id="tUser" placeholder="Kullanƒ±cƒ± Adƒ±" class="w-full p-2 border rounded mb-2"><input id="tPass" placeholder="≈ûifre" class="w-full p-2 border rounded mb-2"><input id="tName" placeholder="Ad Soyad" class="w-full p-2 border rounded mb-2"><button onclick="window.addTeacher()" class="w-full bg-pink-600 text-white py-2 rounded font-bold">Ekle</button></div>
                        <div class="col-span-2 border rounded overflow-hidden"><table class="min-w-full text-sm"><thead class="bg-gray-100"><tr><th class="p-3">Ad</th><th class="p-3">Kullanƒ±cƒ±</th><th class="p-3">≈ûifre</th><th class="p-3">Sil</th></tr></thead><tbody id="teachersListBody"></tbody></table></div>
                    </div>
                </div>`;
            
            window.changeTab = (t) => {
                document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
                const tab = document.getElementById('tab-' + t);
                if(tab) tab.classList.remove('hidden');
                if(t === 'results') loadResults();
                if(t === 'myexams') loadMyExams();
                if(t === 'teachers' && isSuperAdmin) loadTeachers();
            };
            
            // Y√∂nlendirme Yardƒ±mcƒ±sƒ± (Sƒ±navlarƒ±m sekmesinden gelen)
            window.redirectToTab = (tabName, code) => {
                document.getElementById('customModal').classList.add('hidden');
                window.changeTab(tabName);
                setTimeout(() => {
                    if(tabName === 'questions') document.getElementById('uploadQCode').value = code;
                    if(tabName === 'lists') document.getElementById('uploadListCode').value = code;
                }, 100);
            };
            
            loadResults();
            setupDashboardEvents();
        }

        function setupDashboardEvents() {
            document.getElementById('btnSaveSettings').onclick = async () => {
                const code = sanitizeExamCode(document.getElementById('setExamCode').value);
                const time = parseInt(document.getElementById('setTime').value);
                const desc = sanitizeInput(document.getElementById('setDesc').value);
                if(!code) return alert("Kod gerekli");
                try {
                    await setDoc(getConfigRef(code), {
                        teacher_name: currentUser.name,
                        owner_username: currentUser.username,
                        time_limit: time * 60,
                        exam_description: desc,
                        created_at: serverTimestamp()
                    }, { merge: true });
                    alert("Sƒ±nav olu≈üturuldu.");
                    document.getElementById('setExamCode').value = '';
                } catch(e) { alert(e.message); }
            };

            document.getElementById('btnUploadQ').onclick = async () => {
                const code = sanitizeExamCode(document.getElementById('uploadQCode').value);
                const json = document.getElementById('jsonInput').value;
                try { await setDoc(getQuestionsRef(code), { questions_list: JSON.parse(json) }); alert("Y√ºklendi"); } catch(e) { alert("JSON Hatasƒ±"); }
            };

            document.getElementById('btnUploadList').onclick = async () => {
                const code = sanitizeExamCode(document.getElementById('uploadListCode').value);
                const txt = document.getElementById('listInput').innerText;
                const students = [];
                txt.split('\n').forEach(line => {
                    const p = line.split(/\s+|\t/);
                    if(p.length>=3) students.push({number:p[0], className:p[1], name:p.slice(2).join(' ')});
                });
                if(students.length>0) { await setDoc(doc(db, "student_lists", code), { students }); alert("Y√ºklendi"); } else { alert("Format hatasƒ±"); }
            };
        }

        // --- SONU√áLAR ---
        function loadResults() {
            const tbody = document.getElementById('resultsTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="p-4 text-center">Y√ºkleniyor...</td></tr>';
            const fCode = document.getElementById('fCode')?.value.toLowerCase() || "";
            onSnapshot(query(collection(db, "quiz_submissions"), orderBy("timestamp", "desc"), limit(100)), (snap) => {
                allSubmissions = snap.docs.map(d => ({id:d.id, ...d.data()}));
                const filtered = allSubmissions.filter(s => !fCode || s.examCode.toLowerCase().includes(fCode));
                tbody.innerHTML = filtered.map(s => `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3"><div class="font-bold">${s.name}</div><div class="text-xs text-gray-500">${s.number}</div></td>
                        <td class="p-3">${s.examCode}</td>
                        <td class="p-3 font-bold ${s.score>=50?'text-green-600':'text-red-600'}">${s.score}</td>
                        <td class="p-3"><button onclick="window.deleteSub('${s.id}')" class="text-red-600 text-xs">Sil</button></td>
                    </tr>`).join('');
            });
            if(document.getElementById('fCode')) document.getElementById('fCode').oninput = loadResults;
        }
        window.deleteSub = async (id) => { if(confirm("Silinsin mi?")) await deleteDoc(doc(db, "quiz_submissions", id)); };
        window.exportExcel = () => { const ws = XLSX.utils.json_to_sheet(allSubmissions); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Sonuclar"); XLSX.writeFile(wb, "sonuclar.xlsx"); };

        // --- SINAVLARIM (Fƒ∞LTRELƒ∞ & TASARIMLI) ---
        window.loadMyExams = async () => {
            const container = document.getElementById('myExamsList');
            container.innerHTML = '<p class="col-span-full text-center">Y√ºkleniyor...</p>';
            try {
                const [conf, qSnap, lSnap, subSnap] = await Promise.all([
                    getDocs(collection(db, "exam_settings")), getDocs(collection(db, "questions_pool")),
                    getDocs(collection(db, "student_lists")), getDocs(collection(db, "quiz_submissions"))
                ]);
                
                const qCount = {}, lCount = {}, sCount = {};
                qSnap.forEach(d => qCount[d.id] = d.data().questions_list?.length || 0);
                lSnap.forEach(d => lCount[d.id] = d.data().students?.length || 0);
                subSnap.forEach(d => { const c = d.data().examCode; if(c) sCount[c] = (sCount[c]||0)+1; });

                const exams = [];
                conf.forEach(doc => {
                    if(doc.id !== 'admin_config') {
                        const d = doc.data();
                        // Fƒ∞LTRE: Admin hepsini, √ñƒüretmen kendisininkini g√∂r√ºr
                        if(isSuperAdmin || d.owner_username === currentUser.username || (!d.owner_username && isSuperAdmin)) {
                            exams.push({ code: doc.id, ...d, qc: qCount[doc.id]||0, sc: lCount[doc.id]||0, sub: sCount[doc.id]||0 });
                        }
                    }
                });

                if(exams.length === 0) { container.innerHTML = '<div class="col-span-full text-center py-10 text-gray-500">Sƒ±nav bulunamadƒ±.</div>'; return; }

                container.innerHTML = exams.map(e => `
                    <div class="bg-white p-6 border rounded-xl shadow-sm hover:shadow-md transition flex flex-col relative">
                        <div class="flex justify-between items-start mb-4">
                            <div><h3 class="font-extrabold text-xl text-indigo-700">${e.code}</h3><p class="text-sm text-gray-500 mt-1">${e.exam_description || ''}</p></div>
                            <input type="text" class="text-xs p-2 border rounded w-24 text-right" placeholder="√ñzel ƒ∞sim" value="${e.custom_name||''}" onchange="window.updateExamName('${e.code}', this.value)">
                        </div>
                        <div class="space-y-2 text-sm flex-grow">
                            <div class="flex justify-between py-1 border-b"><span class="text-gray-600">Hazƒ±rlayan:</span> 
                                <div class="flex gap-1"><input id="tName-${e.code}" value="${e.teacher_name}" class="border w-24 text-xs px-1"><button onclick="window.updTeacher('${e.code}')" class="text-xs bg-green-500 text-white px-1 rounded">K</button></div>
                            </div>
                            <div class="flex justify-between py-1 border-b"><span class="text-gray-600">S√ºre:</span> <b>${Math.floor(e.time_limit/60)} dk</b></div>
                            <div class="flex justify-between items-center py-1 border-b"><span class="text-gray-600">Soru:</span> <button onclick="window.showExamQuestions('${e.code}')" class="text-blue-600 font-bold text-lg flex items-center">${e.qc} <span class="ml-1 text-xs">‚úèÔ∏è</span></button></div>
                            <div class="flex justify-between items-center py-1 border-b"><span class="text-gray-600">√ñƒürenci:</span> <button onclick="window.showExamStudents('${e.code}')" class="text-blue-600 font-bold text-lg flex items-center">${e.sc} <span class="ml-1 text-xs">üë•</span></button></div>
                            <div class="flex justify-between py-1"><span class="text-gray-600">Katƒ±lƒ±m:</span> <b>${e.sub}</b></div>
                        </div>
                        <button onclick="window.deleteExam('${e.code}')" class="mt-4 w-full bg-red-50 text-red-600 py-2 rounded text-xs font-bold hover:bg-red-100">Sƒ∞L</button>
                    </div>`).join('');
            } catch(e) { container.innerHTML = e.message; }
        };
        window.updateExamName = async (c, n) => await setDoc(getConfigRef(c), { custom_name: sanitizeInput(n) }, { merge: true });
        window.updTeacher = async (c) => {
            const n = document.getElementById('tName-'+c).value;
            await setDoc(getConfigRef(c), { teacher_name: sanitizeInput(n) }, { merge: true });
            alert("G√ºncellendi");
        };

        // --- SORU Y√ñNETƒ∞Mƒ∞ (TEK TEK - 5 ≈ûIKLI - D√úZELTƒ∞LMƒ∞≈û) ---
        window.showExamQuestions = async (code) => {
            try {
                const qSnap = await getDoc(getQuestionsRef(code));
                const questions = qSnap.exists() ? qSnap.data().questions_list : [];
                
                let content = `
                    <div class="sticky top-0 bg-white z-20 pb-4 border-b mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <h3 class="text-xl font-bold text-indigo-700">${code} - Sorular</h3>
                            <div class="flex gap-2">
                                <button onclick="window.redirectToTab('questions','${code}')" class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded font-bold">Toplu Y√ºkle</button>
                                <button onclick="document.getElementById('customModal').classList.add('hidden')" class="text-2xl font-bold">&times;</button>
                            </div>
                        </div>
                        <div class="bg-orange-50 p-3 rounded border border-orange-200 text-sm">
                            <h4 class="font-bold text-orange-800 mb-2 flex"><span id="formTitle">Yeni Soru Ekle</span><button onclick="window.clearQForm()" class="ml-auto text-xs underline">Temizle</button></h4>
                            <input type="hidden" id="editIndex" value="-1">
                            <textarea id="qText" class="w-full p-2 border rounded mb-2" rows="2" placeholder="Soru metni"></textarea>
                            <div class="grid grid-cols-2 gap-2 mb-2">
                                ${['A','B','C','D'].map(l => `<div class="flex items-center"><span class="w-6 font-bold text-gray-500">${l})</span><input id="opt${l}" class="flex-1 p-1 border rounded"></div>`).join('')}
                                <div class="flex items-center col-span-2"><span class="w-6 font-bold text-gray-500">E)</span><input id="optE" class="flex-1 p-1 border rounded bg-gray-100" placeholder="E ≈ûƒ±kkƒ± (ƒ∞steƒüe Baƒülƒ±)"></div>
                            </div>
                            <div class="flex gap-2 mb-2"><input id="qImg" class="flex-1 p-1 border rounded text-xs" placeholder="Resim URL"><select id="qAns" class="p-1 border rounded font-bold"><option value="">Doƒüru Cevap</option>${['A','B','C','D','E'].map(l => `<option value="${l}">${l}</option>`).join('')}</select></div>
                            <button onclick="window.saveQuestion('${code}')" id="saveBtn" class="w-full bg-orange-600 text-white py-2 rounded font-bold">Kaydet</button>
                        </div>
                    </div>
                    <div class="max-h-[40vh] overflow-y-auto space-y-3 pr-1">`;
                    
                if(questions.length === 0) content += '<p class="text-center text-gray-400 py-4">Soru yok.</p>';
                else {
                    questions.forEach((q, i) => {
                        content += `
                            <div class="p-3 border rounded bg-white hover:shadow group relative">
                                <div class="flex justify-between mb-1"><span class="bg-indigo-100 text-indigo-800 text-xs font-bold px-2 rounded">Soru ${i+1}</span><div class="flex gap-1"><button onclick="window.editQ('${code}',${i})" class="text-xs text-blue-600 font-bold">D√ºz</button><button onclick="window.delQ('${code}',${i})" class="text-xs text-red-600 font-bold">Sil</button></div></div>
                                <p class="text-sm font-bold mb-2">${sanitizeInput(q.question)}</p>
                                <div class="grid grid-cols-2 gap-x-4 text-xs text-gray-600">${q.options.map((o,idx) => `<div class="${q.answer===o?'text-green-600 font-bold':''}">${['A','B','C','D','E'][idx]}) ${sanitizeInput(o)}</div>`).join('')}</div>
                            </div>`;
                    });
                }
                content += `</div>`;
                
                showCustomAlert("", content);
                document.getElementById('modalContent').classList.remove('max-w-3xl');
                document.getElementById('modalContent').classList.add('max-w-4xl');
            } catch(e) { alert(e.message); }
        };

        window.saveQuestion = async (code) => {
            const txt = document.getElementById('qText').value.trim();
            const ans = document.getElementById('qAns').value;
            const optsArr = ['A','B','C','D','E'].map(l => document.getElementById('opt'+l).value.trim());
            // E ≈üƒ±kkƒ± opsiyonel: Eƒüer E bo≈üsa options arrayine alma. Ama A,B,C,D dolu olmalƒ±.
            if(!txt || !ans || !optsArr[0] || !optsArr[1] || !optsArr[2] || !optsArr[3]) return alert("Eksik bilgi! (Soru, Cevap ve A-B-C-D ≈üƒ±klarƒ± zorunludur)");
            
            // Eƒüer cevap E ise ama E bo≈üsa hata ver
            if(ans === 'E' && !optsArr[4]) return alert("Cevabƒ± E se√ßtiniz ama E ≈üƒ±kkƒ±nƒ± girmediniz.");
            
            const finalOpts = optsArr.filter(o => o !== ""); // Bo≈ülarƒ± temizle (E bo≈üsa gider)
            
            // Cevap metnini bul
            let correctText = "";
            const map = ['A','B','C','D','E'];
            const ansIndex = map.indexOf(ans);
            if(ansIndex > -1) correctText = optsArr[ansIndex];
            
            const newQ = { question: txt, options: finalOpts, answer: correctText, image: document.getElementById('qImg').value.trim() };
            const idx = parseInt(document.getElementById('editIndex').value);
            
            const ref = getQuestionsRef(code);
            const snap = await getDoc(ref);
            let list = snap.exists() ? snap.data().questions_list : [];
            
            if(idx > -1) list[idx] = newQ; else list.push(newQ);
            await setDoc(ref, { questions_list: list }, { merge: true });
            window.showExamQuestions(code);
        };

        window.editQ = async (code, i) => {
            const snap = await getDoc(getQuestionsRef(code));
            const q = snap.data().questions_list[i];
            document.getElementById('qText').value = q.question;
            document.getElementById('qImg').value = q.image || "";
            ['A','B','C','D','E'].forEach((l, idx) => document.getElementById('opt'+l).value = q.options[idx] || "");
            
            const ansIdx = q.options.indexOf(q.answer);
            if(ansIdx > -1) document.getElementById('qAns').value = ['A','B','C','D','E'][ansIdx];
            
            document.getElementById('editIndex').value = i;
            document.getElementById('formTitle').innerText = "D√ºzenle";
            const btn = document.getElementById('saveBtn');
            btn.innerText = "G√ºncelle"; btn.className = "w-full bg-blue-600 text-white py-2 rounded font-bold";
        };

        window.delQ = async (code, i) => {
            if(!confirm("Silinsin mi?")) return;
            const ref = getQuestionsRef(code); const snap = await getDoc(ref);
            let list = snap.data().questions_list; list.splice(i,1);
            await setDoc(ref, { questions_list: list }, { merge: true });
            window.showExamQuestions(code);
        };

        window.clearQForm = () => {
            document.getElementById('qText').value = "";
            ['A','B','C','D','E'].forEach(l => document.getElementById('opt'+l).value = "");
            document.getElementById('qImg').value = ""; document.getElementById('qAns').value = "";
            document.getElementById('editIndex').value = "-1";
            document.getElementById('formTitle').innerText = "Yeni Soru Ekle";
            const btn = document.getElementById('saveBtn');
            btn.innerText = "Kaydet"; btn.className = "w-full bg-orange-600 text-white py-2 rounded font-bold";
        };

        // --- √ñƒûRENCƒ∞ Y√ñNETƒ∞Mƒ∞ (TEK TEK) ---
        window.showExamStudents = async (code) => {
            try {
                const snap = await getDoc(doc(db, "student_lists", code));
                const students = snap.exists() ? snap.data().students : [];
                students.sort((a,b) => a.className.localeCompare(b.className) || a.name.localeCompare(b.name));
                const content = `
                    <div class="sticky top-0 bg-white z-20 pb-4 border-b mb-4">
                        <div class="flex justify-between items-center mb-2"><h3 class="text-xl font-bold text-teal-700">${code} - √ñƒürenciler</h3>
                        <div class="flex gap-2"><button onclick="window.redirectToTab('lists','${code}')" class="text-xs bg-teal-100 text-teal-800 px-2 py-1 rounded font-bold">Toplu Y√ºkle</button><button onclick="document.getElementById('customModal').classList.add('hidden')" class="text-2xl">&times;</button></div></div>
                        <div class="bg-teal-50 p-3 rounded border flex gap-2"><input id="addNum" placeholder="No" class="w-20 p-2 rounded"><input id="addClass" placeholder="Sƒ±nƒ±f" class="w-20 p-2 rounded"><input id="addName" placeholder="ƒ∞sim" class="flex-1 p-2 rounded"><button onclick="window.addStudent('${code}')" class="bg-teal-600 text-white px-4 rounded font-bold">Ekle</button></div>
                    </div>
                    <div class="max-h-[50vh] overflow-y-auto"><table class="min-w-full text-sm"><tbody class="divide-y">${students.map(s => `<tr><td class="p-2 font-bold">${s.number}</td><td class="p-2">${s.className}</td><td class="p-2">${s.name}</td><td class="p-2 text-right"><button onclick="window.delStudent('${code}','${s.number}')" class="text-red-600 font-bold">Sil</button></td></tr>`).join('')}</tbody></table></div>`;
                showCustomAlert("", content);
            } catch(e) { alert(e.message); }
        };
        window.addStudent = async (code) => {
            const n=document.getElementById('addNum').value.trim(), c=document.getElementById('addClass').value.trim(), na=document.getElementById('addName').value.trim();
            if(!n||!c||!na) return alert("Eksik bilgi");
            const ref = doc(db, "student_lists", code); const snap = await getDoc(ref);
            let s = snap.exists() ? snap.data().students : [];
            if(s.some(x=>x.number===n)) return alert("Bu numara zaten var");
            s.push({number:n, className:c, name:na}); await setDoc(ref, {students:s}, {merge:true}); window.showExamStudents(code);
        };
        window.delStudent = async (code, n) => {
            if(!confirm("Silinsin mi?")) return;
            const ref = doc(db, "student_lists", code); const snap = await getDoc(ref);
            await setDoc(ref, {students: snap.data().students.filter(x=>x.number!==n)}, {merge:true}); window.showExamStudents(code);
        };

        // --- √ñƒûRETMEN Y√ñNETƒ∞Mƒ∞ ---
        window.loadTeachers = async () => {
            const el = document.getElementById('teachersListBody'); el.innerHTML = "Y√ºkleniyor...";
            const snap = await getDocs(collection(db, "teachers"));
            el.innerHTML = snap.docs.map(d => `<tr><td class="p-3 font-bold">${d.data().full_name}</td><td class="p-3">${d.data().username}</td><td class="p-3">***</td><td class="p-3"><button onclick="window.delTeacher('${d.id}')" class="text-red-600 font-bold">Sil</button></td></tr>`).join('');
        };
        window.addTeacher = async () => {
            const u=document.getElementById('tUser').value.trim(), p=document.getElementById('tPass').value.trim(), n=document.getElementById('tName').value.trim();
            if(!u||!p||!n) return alert("Eksik"); if(u.toLowerCase()==='admin') return alert("Yasak isim");
            const q = await getDocs(query(collection(db, "teachers"), where("username","==",u))); if(!q.empty) return alert("Kullanƒ±cƒ± adƒ± dolu");
            await addDoc(collection(db, "teachers"), {username:u, password:p, full_name:n, created_at: serverTimestamp()}); alert("Eklendi"); loadTeachers();
        };
        window.delTeacher = async (id) => { if(confirm("Silinsin mi?")) await deleteDoc(doc(db, "teachers", id)); loadTeachers(); };

        window.deleteExam = async (code) => {
            if(!confirm(`"${code}" sƒ±navƒ±nƒ± ve t√ºm verilerini silmek istediƒüinize emin misiniz?`)) return;
            await Promise.all([ deleteDoc(doc(db,"exam_settings",code)), deleteDoc(doc(db,"questions_pool",code)), deleteDoc(doc(db,"student_lists",code)) ]);
            const s = await getDocs(query(collection(db,"quiz_submissions"), where("examCode","==",code)));
            s.forEach(d => deleteDoc(d.ref));
            alert("Silindi."); loadMyExams();
        };

        function showCustomAlert(title, msg) {
            const m = document.getElementById('modalContent'); m.innerHTML = (title ? `<h3 class="text-xl font-bold mb-2">${title}</h3>` : '') + msg;
            document.getElementById('customModal').classList.remove('hidden'); document.getElementById('customModal').classList.add('flex');
        }

        initializeFirebase();
    </script>
</body>
</html>
